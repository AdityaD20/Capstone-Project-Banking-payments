<div class="container-fluid pt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Manage Vendors</h3>
    <div>
      <button class="btn btn-primary" (click)="openAddVendorModal()">
        Add Vendor
      </button>
    </div>
  </div>
  <hr>

  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      Vendor List
      <button class="btn btn-sm btn-outline-secondary" (click)="loadVendors()">Refresh</button>
    </div>
    <div class="card-body">
      <!-- UPDATED SECTION: Checks for isLoading before trying to render the list -->
      <div *ngIf="!isLoading">
        <div *ngIf="(vendors$ | async) as vendors; else noVendorsTpl">
          <div *ngIf="vendors.length > 0; else noVendorsTpl" class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Contact Email</th>
                  <th>Contact Phone</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let vendor of vendors">
                  <td>{{ vendor.id }}</td>
                  <td>{{ vendor.name }}</td>
                  <td>{{ vendor.contactEmail }}</td>
                  <td>{{ vendor.contactPhone }}</td>
                  <td>
                    <span class="badge" [ngClass]="{
                      'text-bg-success': vendor.status === 'ACTIVE',
                      'text-bg-secondary': vendor.status === 'DISABLED'
                    }">{{ vendor.status | titlecase }}</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- ADDED Loading indicator -->
      <div *ngIf="isLoading" class="p-3 text-muted">Loading vendors...</div>

      <!-- Reusable Template for No Vendors -->
      <ng-template #noVendorsTpl>
        <div class="p-3 text-muted">No vendors have been added yet.</div>
      </ng-template>
    </div>
  </div>
</div>


<!-- "Add Vendor" Modal -->
<div class="modal fade" [class.show]="isAddVendorModalVisible" [style.display]="isAddVendorModalVisible ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <app-add-vendor-form (close)="closeAddVendorModal()" (success)="onVendorAdded()"></app-add-vendor-form>
    </div>
  </div>
</div>
<div *ngIf="isAddVendorModalVisible" class="modal-backdrop fade show"></div>