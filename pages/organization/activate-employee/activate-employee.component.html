<div class="container-fluid pt-4">
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border"></div><p class="mt-2">Loading Employee Details...</p>
  </div>

  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">{{ errorMessage }}</div>

  <div *ngIf="employee && !isLoading && !errorMessage">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Review & Activate: {{ employee.firstName }} {{ employee.lastName }}</h3>
      <a routerLink="/organization/employees" class="btn btn-secondary">Back to Employee List</a>
    </div>
    <hr>

    <div class="row g-4">
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">Submitted Documents</div>
          <div class="card-body">
            <div *ngIf="documents$ | async as documents; else loadingDocs">
              <div *ngIf="documents.length > 0; else noDocuments" class="list-group list-group-flush">
                <a *ngFor="let doc of documents" [href]="doc.url" target="_blank" class="list-group-item list-group-item-action">
                  {{ doc.displayName || 'Unnamed Document' }}
                </a>
              </div>
              <ng-template #noDocuments><p class="text-muted">No documents found.</p></ng-template>
            </div>
            <ng-template #loadingDocs><p class="text-muted">Loading...</p></ng-template>
          </div>
        </div>
      </div>
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">Activation Details & Salary Structure</div>
          <form [formGroup]="activationForm" (ngSubmit)="onActivate()">
            <div class="card-body">
              <div class="row g-3">
                <div class="col-12"><label class="form-label">Employee Number</label><input type="text" class="form-control" formControlName="employeeNumber"></div>
                <div class="col-md-6"><label class="form-label">Account Number</label><input type="text" class="form-control" formControlName="accountNumber"></div>
                <div class="col-md-6"><label class="form-label">IFSC Code</label><input type="text" class="form-control" formControlName="ifscCode"></div>
                <div class="col-12"><label class="form-label">Bank Name</label><input type="text" class="form-control" formControlName="bankName"></div>
                <div class="col-md-6"><label class="form-label">Basic Salary</label><input type="number" class="form-control" formControlName="basicSalary"></div>
                <div class="col-md-6"><label class="form-label">HRA(40%)</label><input type="number" class="form-control" formControlName="hra" [readonly]="true"></div>
                <div class="col-md-6"><label class="form-label">DA(15%)</label><input type="number" class="form-control" formControlName="da" [readonly]="true"></div>
                <div class="col-md-6"><label class="form-label">PF(12%)</label><input type="number" class="form-control" formControlName="pf" [readonly]="true"></div>
                <div class="col-12"><label class="form-label">Other Allowances(10%)</label><input type="number" class="form-control" formControlName="otherAllowances" [readonly]="true"></div>
              </div>
            </div>
            <div class="card-footer d-flex justify-content-between">
              <button type="button" class="btn btn-danger" (click)="onReject()" [disabled]="isActivating || isRejecting">
                <span *ngIf="isRejecting" class="spinner-border spinner-border-sm me-2"></span>
                {{ isRejecting ? 'Rejecting...' : 'Reject Documents' }}
              </button>
              <button type="submit" class="btn btn-success" [disabled]="isActivating || isRejecting || activationForm.invalid">
                <span *ngIf="isActivating" class="spinner-border spinner-border-sm me-2"></span>
                {{ isActivating ? 'Activating...' : 'Approve & Activate' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" [class.show]="isRejectionModalVisible" [style.display]="isRejectionModalVisible ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <app-rejection-dialog
        [title]="'Reject Documents for ' + (employee?.firstName || '')"
        prompt="Please provide a clear reason for rejecting these documents. The employee will see this message."
        (close)="closeRejectionModal()"
        (submitReason)="onRejectionSubmit($event)">
      </app-rejection-dialog>
    </div>
  </div>
</div>
<div *ngIf="isRejectionModalVisible" class="modal-backdrop fade show"></div>
</div>