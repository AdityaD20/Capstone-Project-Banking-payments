<div class="container-fluid pt-4">
  <h3 class="mb-4">Create a New Vendor Payment</h3>

  <div class="card" style="max-width: 700px;">
    <div class="card-body">
      <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
        <div *ngIf="submitError" class="alert alert-danger">{{ submitError }}</div>
        <div *ngIf="vendorLoadError" class="alert alert-warning">{{ vendorLoadError }}</div>

        <!-- Vendor Selection -->
        <div class="mb-3">
          <label for="vendorId" class="form-label">Select Vendor</label>
          <div *ngIf="isLoadingVendors">
            <p class="text-muted">Loading vendors...</p>
          </div>
          <!-- Now subscribes to the vendors$ observable -->
          <select id="vendorId" class="form-select" formControlName="vendorId" *ngIf="!isLoadingVendors">
            <option [ngValue]="null" disabled>-- Choose a vendor --</option>
            <option *ngFor="let vendor of (vendors$ | async)" [ngValue]="vendor.id">
              {{ vendor.name }} ({{ vendor.contactEmail }})
            </option>
          </select>
        </div>

        <!-- Amount -->
        <div class="mb-3">
          <label for="amount" class="form-label">Payment Amount</label>
          <div class="input-group">
            <span class="input-group-text">â‚¹</span>
            <input type="number" id="amount" class="form-control" formControlName="amount" placeholder="0.00">
          </div>
        </div>

        <!-- Description -->
        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea id="description" class="form-control" formControlName="description" rows="3"></textarea>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-primary" [disabled]="isSubmitting || paymentForm.invalid || isLoadingVendors">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            {{ isSubmitting ? 'Submitting...' : 'Submit Payment Request' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>